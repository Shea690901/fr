static private mixed rest;

mixed find_match(string str, mixed ob) {
mixed *array, test;
int i, num;
string nick, type;

  if (stringp(ob)) {
    ob -> dummy();
    ob = find_object(ob);
  }
  if (!ob || intp(ob))
    return ({ });
  if (!pointerp(ob)) {
    test = (mixed)ob->find_inv_match(str);
    if (!test)
      return ({ });
    return test;
  }
  if (str == "" || !str)
    return ({ });
  test = ({ });
  rest = ({ });
  nick = (string)this_object()->expand_nickname(str);
  if (!nick && this_player())
    nick = (string)this_player()->expand_nickname(str);
  if (nick && nick!="")
    str = nick;
  parse_command(str,ob,"%i",test);
  if (!test || !sizeof(test))
    return ({ });
  array = map_array(test[1..sizeof(test)], "query_simul_efun_id",
                         this_object(), ({ test[0], str }));
  return filter_array(array,
                      "fixup_parse_command", this_object()) + rest;
}

object query_simul_efun_id(object ob, mixed *arr) { 
  mixed ret;
  ret = (mixed)ob->query_parse_id(arr);
  if (!pointerp(ret))
    return ret;
  rest += ret[1..sizeof(ret)];
  return ret[0];
}

int fixup_parse_command(mixed ob) {
  return objectp(ob);
}

/*
 * What the hell would need this???
*/
int vowel(int i) {
     return (i == 'a' || i == 'e' || i == 'i' || i == 'o' || i == 'u');
     }

/*
 * I want to find where this is called and change it.
 * when (if) I implement this the params will be the other way around!!
 * consistent with bindex!!
 *
 * int index(mixed *array, mixed match) {
 * int i;
 *     log_file("INDEX", "Called from "+file_name(previous_object()) + "\n");
 *     for (i=0;i<sizeof(array);i++)
 *     if (array[i] == match) return i;
 *         return -1;
 *     }
 */

/*
 * use print_object() ;)
 *
 * write_object_array(ob) {
 * int i;
 *     if (!pointerp(ob)) { write(ob); write(" "); return; }
 *     write("({ ");
 *     for (i=0;i<sizeof(ob);++i) write_object_array(ob[i]);
 *     write(" })\n");
 *     }
 */

/* 
 * I want to find what uses this code so I can change it!
 *
 * private static string *numbers;
 * 
 * string write_number(int i) {
 *     if (!sizeof(numbers))
 *         numbers = ({
 *             "Zero","One","Two","Three","Four","Five","Six",
 *             "Seven","Eight","Nine","Ten","Eleven","Twelve"
 *             });
 *     if (i>12) return "many";
 *     return numbers[i];
 *     }
 */
 
shout(string str, object avoid) {
object ob;
int i;
    ob = users();
    for (i=0;i<sizeof(ob);i++)
        if (ob[i] != avoid && !ob[i] -> query_earmuffs())
        if(ob[i] != this_player()) {
          tell_object(ob[i], str);
        }
    }

mixed *delete(mixed *arr, int start, int len) {
  if(start == 0) {
    return arr[len..sizeof(arr) - 1];
  }
  if(start + len == sizeof(arr) - 1) {
    return arr[0..start - 1];
  }
  return arr[0..start-1]+arr[start+len..sizeof(arr)];
}

mixed *slice_array(mixed *arr, int start, int fin) {
  return arr[start..fin];
}

mixed *insert(mixed *arr, mixed el, int pos) {
  return arr[0..pos-1]+({ el })+arr[pos..sizeof(arr)];
}

int bindex(mixed el, mixed *array) {
int i, j, k;
 
    if (!pointerp(array)) return -1;
    k = sizeof(array)-1;
    if (el < array[0]) return -1;
    else if (el > array[k]) return -(k+2);
    do {
	i = (j+k)/2;
	if (array[i] == el) return i;
	else if (el>array[i]) j = i;
	else k = i;
	} while (j+1 < k);
    return -j-2;
    }
 
mixed *binsert(mixed el, mixed *array) {
int i;
    if (!pointerp(array)) return ({ el });
    i = bindex(el, array);
    if (i >= 0) array = insert(array, el, i);
    else array = insert(array, el, -i-1);
    return array;
    }

void write(mixed str) {
  int cols;

  if (intp(str)) {
    efun::write(str);
    return ;
  }
  cols = (int)this_player()->query_cols();
  if (!cols)
    cols = 75;
  if(!str) {
    str = "";
  }
  printf("%-=*s", cols, str);
}

/*
 * returns the number of lines in a file.
 *
int file_length(string file_name) {
  int top, bottom;

  if ((top = file_size(file_name)) < 0) return top;
  top = top / 46;
  if(top < 2)
    top = 2;
  bottom = 1;
  while (read_file(file_name, top)) {
    top = top + top/2; /* top *= 1.5; */
  }
  while (top > bottom+1) {
    if (read_file(file_name, (top+bottom)/2)) {
      bottom = (top+bottom)/2;
    } else {
      top = (top+bottom)/2;
    }
  }
  return bottom-1;
}
 *
 */

/*
 *
string pluralise(string str) {
  return str+"s";
}

 *
 */
