#include <udp.h>

void create() {
  seteuid(getuid());
} /* create() */

void incoming_request(mapping info) { 
    if (file_name(previous_object()) != NAMESERVER_CD)
       return ;
    if(info["CC"])
      info["CC"] = explode(info["CC"], ","); 
    else
      info["CC"] = ({}); 
    info["MSG"] = replace_string(info["MSG"], " \b|", "|"); 
    if(info["WIZTO"])
      info["WIZTO"] = explode(info["WIZTO"], ","); 
    if(!((int)REMOTEPOST_D->incoming_post(info)))
      info["RESEND"] = 1; 
    log_file("reports/incoming_mail", info["NAME"]+" "+info["MSG"]);
    NAMESERVER_CD->send_udp(info["HOSTADDRESS"], info["PORTUDP"], 
      sprintf("@@@%s||NAME:%s||PORTUDP:%d%s%s@@@\n", UDP_MAIL_A, 
      mud_name(), NAMESERVER_CD->query_my_port(),
      (info["ENDMSG"] ? "||ENDMSG:1" : ""), 
         (info["RESEND"] ? "||RESEND:1" :""))); 
} /* incoming_request() */
